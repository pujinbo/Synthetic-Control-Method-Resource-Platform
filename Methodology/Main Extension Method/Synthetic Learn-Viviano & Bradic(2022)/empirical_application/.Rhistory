setwd('/home/davide/Dropbox/causalgroup/SyntheticControl/R&R1_JOE/code_submission2')
working_dir <- '.'
source(paste0(working_dir, '/makeplots_Fig3.R'))
source(paste0(working_dir, '/makeplots_Fig2.R'))
source(paste0(working_dir, '/makeplots_Fig2.R'))
getwd()
working_dir <- '.'
source(paste0(working_dir, '/makeplots_Fig2.R'))
source(paste0(working_dir, '/makeplots_Fig3.R'))
source(paste0(working_dir, '/makeplots_FigA4-A5.R'))
working_dir <- '.'
source(paste0(working_dir, '/makeplots_FigA4-A5.R'))
simulation12
working_directory <- '.'
load(paste0(working_directory, '/saved_results/oracle_endo_time.RData'))
sim9 <- simulation5[[1]][,2:5]
sim9 <- as.vector(sim9)
alpha = c('alpha 0', 'alpha 0.1','alpha 0.2', 'alpha 0.3','alpha 0.5','alpha 0.7', 'alpha 1','alpha 1.5')
alpha <- rep(alpha, 4)
methods <- c(rep('SC', 8),rep('SC-Learner1', 8), rep('SC-Learner2', 8), rep('DiD',8))
sim9 <- cbind(sim9, alpha, methods)
sim9 <- as.data.frame(sim9)
sim9[,1]<- as.numeric(as.character(sim9[,1]))
p1<-ggplot(sim9, aes(x=alpha, y=sim9, group=methods)) +
geom_line(aes(color=methods))+
geom_point(aes(color=methods)) +
labs(title="Percentage of rejections - DGP1",x="alpha", y = "")
jpeg(paste0(working_directory, '/plots_FigA4-A5/myplot1.jpeg'))
print(p1)
dev.off()
sim14 <- simulation10[[1]][,2:5]
sim14 <- as.vector(sim14)
alpha = c('alpha 0', 'alpha 0.1','alpha 0.2', 'alpha 0.3','alpha 0.5','alpha 0.7', 'alpha 1','alpha 1.5')
alpha <- rep(alpha, 4)
methods <- c(rep('SC', 8),rep('SC-Learner1', 8), rep('SC-Learner2', 8), rep('DiD',8))
sim14 <- cbind(sim14, alpha, methods)
sim14 <- as.data.frame(sim14)
sim14[,1]<- as.numeric(as.character(sim14[,1]))
p2<-ggplot(sim14, aes(x=alpha, y=sim14, group=methods)) +
geom_line(aes(color=methods))+
geom_point(aes(color=methods)) +
labs(title="Percentage of rejections - DGP5",x="alpha", y = "")
jpeg(paste0(working_directory, '/plots_FigA4-A5/myplot2.jpeg'))
print(p2)
dev.off()
sim10 <- simulation6[[1]][,2:5]
sim10 <- as.vector(sim10)
alpha = c('alpha 0', 'alpha 0.1','alpha 0.2', 'alpha 0.3','alpha 0.5','alpha 0.7', 'alpha 1','alpha 1.5')
alpha <- rep(alpha, 4)
methods <- c(rep('SC', 8),rep('SC-Learner1', 8), rep('SC-Learner2', 8), rep('DiD',8))
sim10 <- cbind(sim10, alpha, methods)
sim10 <- as.data.frame(sim10)
sim10[,1]<- as.numeric(as.character(sim10[,1]))
p3<-ggplot(sim10, aes(x=alpha, y=sim10, group=methods)) +
geom_line(aes(color=methods))+
geom_point(aes(color=methods)) +
labs(title="Percentage of rejections - DGP2(a)",x="alpha", y = "")
jpeg(paste0(working_directory, '/plots_FigA4-A5/myplot3.jpeg'))
print(p3)
dev.off()
sim11 <- simulation7[[1]][,2:5]
sim11 <- as.vector(sim11)
alpha = c('alpha 0', 'alpha 0.1','alpha 0.2', 'alpha 0.3','alpha 0.5','alpha 0.7', 'alpha 1','alpha 1.5')
alpha <- rep(alpha, 4)
methods <- c(rep('SC', 8),rep('SC-Learner1', 8), rep('SC-Learner2', 8), rep('DiD',8))
sim11 <- cbind(sim11, alpha, methods)
sim11 <- as.data.frame(sim11)
sim11[,1]<- as.numeric(as.character(sim11[,1]))
p4<-ggplot(sim11, aes(x=alpha, y=sim11, group=methods)) +
geom_line(aes(color=methods))+
geom_point(aes(color=methods)) +
labs(title="Percentage of rejections - DGP2(b)",x="alpha", y = "")
jpeg(paste0(working_directory, '/plots_FigA4-A5/myplot4.jpeg'))
print(p4)
dev.off()
sim6 <- simulation3[[1]][,2:5]
sim6 <- as.vector(sim6)
alpha = c('alpha 0', 'alpha 0.1','alpha 0.2', 'alpha 0.3','alpha 0.5','alpha 0.7', 'alpha 1','alpha 1.5')
alpha <- rep(alpha, 4)
simulation3
simulation7
source(paste0(working_dir, '/makeplots_FigA4-A5.R'))
working_dir <- '.'
source(paste0(working_dir, '/makeplots_FigA4-A5.R'))
working_dir <- '.'
source(paste0(working_dir, '/makeplots_FigA4-A5.R'))
library(ggplot2)
library(RColorBrewer)
library(grid)
library(datasets)
library(ggplot2)
fill <- "#4271AE"
lines <- "#1F3552"
##########################################################################
#### Plots on Power
##########################################################################
working_directory <- '.'
load(paste0(working_directory, '/saved_results/oracle_endo_time.RData'))
sim <- simulation5[[1]][,2:5]
sim <- as.vector(sim)
alpha = c('alpha 0', 'alpha 0.1','alpha 0.2', 'alpha 0.3','alpha 0.5','alpha 0.7', 'alpha 1','alpha 1.5')
alpha <- rep(alpha, 4)
methods <- c(rep('SC', 8),rep('SC-Learner1', 8), rep('SC-Learner2', 8), rep('DiD',8))
sim <- cbind(sim, alpha, methods)
sim <- as.data.frame(sim)
sim[,1]<- as.numeric(as.character(sim[,1]))
p1<-ggplot(sim, aes(x=alpha, y=sim, group=methods)) +
geom_line(aes(color=methods))+
geom_point(aes(color=methods)) +
labs(title="Percentage of rejections - DGP1",x="alpha", y = "")
jpeg(paste0(working_directory, '/plots_FigA4-A5/myplot1.jpeg'))
print(p1)
dev.off()
sim <- simulation10[[1]][,2:5]
sim <- as.vector(sim)
alpha = c('alpha 0', 'alpha 0.1','alpha 0.2', 'alpha 0.3','alpha 0.5','alpha 0.7', 'alpha 1','alpha 1.5')
alpha <- rep(alpha, 4)
methods <- c(rep('SC', 8),rep('SC-Learner1', 8), rep('SC-Learner2', 8), rep('DiD',8))
sim <- cbind(sim, alpha, methods)
sim <- as.data.frame(sim)
sim[,1]<- as.numeric(as.character(sim[,1]))
p2<-ggplot(sim14, aes(x=alpha, y=sim, group=methods)) +
geom_line(aes(color=methods))+
geom_point(aes(color=methods)) +
labs(title="Percentage of rejections - DGP5",x="alpha", y = "")
jpeg(paste0(working_directory, '/plots_FigA4-A5/myplot2.jpeg'))
print(p2)
dev.off()
working_dir <- '.'
source(paste0(working_dir, '/makeplots_FigA4-A5.R'))
working_dir <- '.'
source(paste0(working_dir, '/makeplots_FigA4-A5.R'))
working_dir <- '.'
source(paste0(working_dir, '/makeplots_Fig4-A6.R'))
working_dir <- '.'
source(paste0(working_dir, '/makeplots_Fig5.R'))
working_dir <- '.'
source(paste0(working_dir, '/make_table1.R'))
working_dir <- '.'
source(paste0(working_dir, '/makeplots_FigA7.R'))
working_dir <- '.'
source(paste0(working_dir, '/makeplots_FigA7.R'))
working_dir <- '.'
source(paste0(working_dir, '/makeplots_FigA8.R'))
## Upload data
source('./empirical_application/do_file3.R')
getwd()
setwd('/home/davide/Dropbox/causalgroup/SyntheticControl/R&R1_JOE/empirical_application')
## Upload data
source('./empirical_application/do_file3.R')
getwd()
## Upload data
source('./do_file3.R')
## Upload data
source('./do_file.R')
XXX <- read.table('./MEDCOST_STATES_CHILDLESS_ADULTS.txt')
## Upload library
source('./library.R')
source('./my_panel_view_function.R')
## Unit root testing
library(fUnitRoots)
library(tseries)
test1 <- unitrootTest(med_ts, lags = 1, type = 'c')
p1 <- punitroot(test1@test$statistic)
test2 <- unitrootTest(med_ts, lags = 2, type = 'c')
p2 <- punitroot(test2@test$statistic)
test3 <- unitrootTest(med_ts, lags = 3, type = 'c')
p3 <- punitroot(test3@test$statistic)
c(p1,p2,p3)
write.table(c(p1,p2,p3), file = './unit_root/p_values.txt')
write.table(c(p1,p2,p3), file = './unit_root_test/p_values.txt')
## Remove Massachutes and Oregon
data_ts <- XXX[,-c(22,38)]
## Add as control Employment
employment <- read.table('./employment_BFRSS.txt')
data_ts <- cbind(data_ts, Tenn = med_ts)
## Average quarterly
data_ts_new <- matrix(nrow = 100, ncol = dim(data_ts)[2])
employment_new <- matrix(nrow = 100, ncol = dim(employment)[2])
med_ts_new  <-  rep(NA, 100)
k <- 1
for(i in 1:100){
data_ts_new[i,] <- apply(as.matrix(data_ts[k:(k+2), ]), 2, function(x) mean(unlist(x)))
med_ts_new[i] <- mean(med_ts[k:(k+2)])
employment_new[i,] <-   apply(as.matrix(employment[k:(k+2), ]), 2, function(x) mean(unlist(x)))
k <- k + 3
}
data_ts <- data_ts_new
data_ts <- apply(data_ts, 2, as.numeric)
med_ts <- med_ts_new
employment <- employment_new
## Make predictions
## validate eta
k <- 1
loss <- rep(NA, 100)
## Generate experts using the window from 78 to 156
best_eta <- 50
## Generate experts using the window from 78 to 156
best_eta <- 50 ## eta = 0.05 (note:losses are rescaled)
Experts1 <- generate_experts(T_0=20, T1=51, N=100, xgboost = F, factor_model = T,
lasso=T, X=as.matrix(data_ts[, -dim(data_ts)[2]]),
y=med_ts, sc_control = F, double_lasso = F, randforest = T, SVM=F,
arima = F, constraint = c(0.5,1,1.5), RNN=F, did=T, external_covariates=employment)
Experts1 <- generate_experts(T_0=20, T1=51, N=100, xgboost = F, factor_model = T,
lasso=T, X=as.matrix(data_ts[, -dim(data_ts)[2]]),
y=med_ts, sc_control = F, double_lasso = F, randforest = T, SVM=F,
arima = F, constraint = c(0.5,1,1.5), RNN=F, did=T, external_covariates=employment)
weights_T1 <- Exp_algorithm(med_ts[1:20], Experts1[1:20,],  eta=best_eta)
## Recompute experts on the full sample
Y_hat1A <- apply(Experts1, 1, function(x) weights_T1%*%x)
plot(med_ts, type='n',main='', ylab='MEDCOST', xlab='Year', xaxt='n')
lines(y=seq(from=0, to =100, length = length(med_ts)), x=rep(51, length(med_ts)), col='green', lty='dotted')
axis(1, at=seq(from=1, to = length(med_ts), by =4),labels=rev(unique(Tennessee_Childless$IYEAR)[-c(2)]), las=2)
plot(med_ts, type='n',main='', ylab='MEDCOST', xlab='Year', xaxt='n')
dev.off()
plot(med_ts, type='n',main='', ylab='MEDCOST', xlab='Year', xaxt='n')
dev.off()
my_panelView <- function(data, # a data frame (long-form)
formula = NULL,
Y = NULL,
D = NULL,
X = NULL,
index, # c(unit, time) indicators
na.rm = TRUE, # remove missing values
treatment = TRUE,
outcome.type = "continuous", # continuous or discrete
type = "treat", ## treat or outcome
by.group = FALSE, # (color pre-treatment treated differently)
theme.bw = FALSE,
xlim = NULL,
ylim = NULL,
xlab = NULL,
ylab = NULL,
gridOff = FALSE,
legendOff = FALSE,
legend.labs = NULL,
main = NULL,
id = NULL,
show.id = NULL,
color = NULL,
axis.adjust = FALSE,
axis.lab = "both",
axis.lab.gap = c(0, 0),
shade.post = TRUE,
my_gap = 30) {
varnames <- all.vars(formula)
## outcome
Y <- varnames[1]
## treatment indicator and covar
D <- varnames[2]
X <- NULL
data <- dd
## exclude other covariates
data <- data[,c(index, Y, D, X)]
type <- "outcome"
## check treatment indicator
d.level <- NULL
d.bi <- FALSE
id = NULL
d.level <- sort(unique(data[, D]))
d.bi <- d.level[1] == 0 & d.level[2] == 1 & length(d.level) == 2
